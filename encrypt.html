<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ–‡å­—åŠ å¯†è§£å¯†ç³»ç»Ÿ | Text Encryption & Decryption</title>
    <meta name="description" content="åŸºäºAES-GCMçš„æ–‡å­—åŠ å¯†è§£å¯†å·¥å…·ï¼Œæ”¯æŒä¸­è‹±æ–‡ï¼Œå®‰å…¨å¯é ">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            color-scheme: light;
            --primary-color: #0071e3;
            --secondary-color: #4f46e5;
            --success-color: #10b981;
            --error-color: #ef4444;
            --warning-color: #f59e0b;
            --bg-gradient: radial-gradient(circle at 20% 20%, #d8ebff 0%, #eff3f8 45%, #e8edf5 100%);
            --card-bg: rgba(255, 255, 255, 0.72);
            --surface-bg: rgba(255, 255, 255, 0.45);
            --text-color: #1d1d1f;
            --text-secondary: #6e6e73;
            --border-color: rgba(255, 255, 255, 0.55);
            --shadow: 0 24px 45px rgba(15, 23, 42, 0.1);
            --glass-blur: blur(20px);
        }

        body.dark-mode {
            color-scheme: dark;
            --primary-color: #4da3ff;
            --secondary-color: #818cf8;
            --bg-gradient: radial-gradient(circle at 20% 10%, #1f2937 0%, #0b1120 55%, #020617 100%);
            --card-bg: rgba(15, 23, 42, 0.66);
            --surface-bg: rgba(30, 41, 59, 0.55);
            --text-color: #f5f5f7;
            --text-secondary: #c7c7cc;
            --border-color: rgba(148, 163, 184, 0.35);
            --shadow: 0 24px 45px rgba(0, 0, 0, 0.35);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Noto Sans SC', Roboto, sans-serif;
            background: var(--bg-gradient);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: var(--text-color);
            padding: 1rem;
            transition: background 0.35s ease, color 0.35s ease;
        }

        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        /* Header */
        .header {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: var(--shadow);
            text-align: center;
            animation: fadeInDown 0.5s ease;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 700;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 0.5rem;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.2rem;
        }

        .header-actions {
            margin-left: auto;
            display: flex;
            gap: 0.65rem;
            flex-wrap: wrap;
        }

        .header .subtitle {
            color: var(--text-secondary);
            font-size: 0.95rem;
        }

        .algorithm-info {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--surface-bg);
            border-radius: 0.75rem;
            border-left: 4px solid var(--primary-color);
        }

        .algorithm-info h3 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.5rem;
        }

        .algorithm-info p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
            flex: 1;
        }

        .section {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            animation: fadeInUp 0.5s ease;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title .icon {
            font-size: 1.5rem;
        }

        .encrypt-section .section-title {
            color: var(--primary-color);
        }

        .decrypt-section .section-title {
            color: var(--secondary-color);
        }

        /* Form Elements */
        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-label {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-color);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label .required {
            color: var(--error-color);
        }

        .form-input,
        .form-textarea {
            width: 100%;
            padding: 0.75rem 1rem;
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            font-size: 0.95rem;
            font-family: inherit;
            transition: all 0.2s ease;
            color: var(--text-color);
            background: var(--surface-bg);
        }

        .form-input:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            background: rgba(255, 255, 255, 0.86);
            box-shadow: 0 0 0 3px rgba(0, 113, 227, 0.15);
        }

        body.dark-mode .form-input:focus,
        body.dark-mode .form-textarea:focus {
            background: rgba(15, 23, 42, 0.9);
            box-shadow: 0 0 0 3px rgba(77, 163, 255, 0.22);
        }

        .form-textarea {
            min-height: 150px;
            resize: vertical;
            font-family: 'Monaco', 'Menlo', 'Courier New', monospace;
        }

        .password-input-wrapper {
            position: relative;
        }

        .password-toggle {
            position: absolute;
            right: 1rem;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.25rem;
            color: var(--text-secondary);
            padding: 0.25rem;
            transition: color 0.2s ease;
        }

        .password-toggle:hover {
            color: var(--primary-color);
        }

        /* Buttons */
        .btn {
            padding: 0.875rem 1.5rem;
            border: none;
            border-radius: 0.75rem;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            border: 1px solid transparent;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary {
            background: linear-gradient(135deg, #0a84ff 0%, #4f7dff 100%);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #5e5ce6 0%, #a855f7 100%);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-outline {
            background: var(--surface-bg);
            border: 1px solid var(--border-color);
            color: var(--text-color);
        }

        .btn-ghost {
            background: rgba(10, 132, 255, 0.1);
            border: 1px solid rgba(10, 132, 255, 0.25);
            color: var(--primary-color);
            padding: 0.625rem 1rem;
            font-size: 0.85rem;
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .action-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
        }

        /* Operation Area */
        .operation-area {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 1.5rem;
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-direction: column;
            gap: 1rem;
            animation: fadeIn 0.5s ease;
        }

        .operation-title {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }

        /* Alert Messages */
        .alert {
            padding: 1rem 1.25rem;
            border-radius: 0.75rem;
            font-size: 0.875rem;
            line-height: 1.5;
            animation: slideDown 0.3s ease;
            display: none;
        }

        .alert.show {
            display: block;
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid var(--success-color);
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid var(--error-color);
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid var(--primary-color);
        }

        /* Footer */
        .footer {
            background: var(--card-bg);
            backdrop-filter: var(--glass-blur);
            border: 1px solid var(--border-color);
            border-radius: 1.5rem;
            padding: 2rem;
            box-shadow: var(--shadow);
            margin-top: 1.5rem;
            animation: fadeInUp 0.5s ease;
        }

        .usage-tips {
            margin-bottom: 1.5rem;
        }

        .usage-tips h3 {
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 1rem;
        }

        .tips-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .tip-item {
            display: flex;
            gap: 0.75rem;
            padding: 1rem;
            background: var(--surface-bg);
            border-radius: 0.75rem;
        }

        .tip-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .tip-content h4 {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 0.25rem;
        }

        .tip-content p {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.4;
        }

        .copyright {
            text-align: center;
            padding-top: 1.5rem;
            border-top: 1px solid var(--border-color);
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                max-height: 0;
            }
            to {
                opacity: 1;
                max-height: 200px;
            }
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            body {
                padding: 0.75rem;
            }

            .header {
                padding: 1.5rem;
                border-radius: 1rem;
            }

            .header-top {
                align-items: stretch;
                flex-direction: column;
            }

            .header-actions {
                margin-left: 0;
                width: 100%;
            }

            .header-actions .btn {
                flex: 1;
            }

            .header h1 {
                font-size: 1.5rem;
            }

            .main-content {
                grid-template-columns: 1fr;
            }

            .section {
                padding: 1.5rem;
                border-radius: 1rem;
            }

            .section-title {
                font-size: 1.125rem;
            }

            .action-buttons {
                grid-template-columns: 1fr;
            }

            .quick-actions {
                grid-template-columns: 1fr;
            }

            .tips-grid {
                grid-template-columns: 1fr;
            }

            .footer {
                padding: 1.5rem;
                border-radius: 1rem;
            }

            .form-textarea {
                min-height: 130px;
            }
        }

        @media (max-width: 420px) {
            body {
                padding: 0.5rem;
            }

            .header,
            .section,
            .operation-area,
            .footer {
                border-radius: 0.9rem;
                padding: 1.1rem;
            }

            .btn {
                padding: 0.75rem 1rem;
            }
        }

        /* Loading State */
        .btn.loading {
            position: relative;
            color: transparent;
        }

        .btn.loading::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 0.6s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Character Counter */
        .char-counter {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: right;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-top">
                <div></div>
                <div class="header-actions">
                    <button class="btn btn-ghost" onclick="goHome()">ğŸ  è¿”å›ä¸»é¡µ</button>
                    <button id="themeToggleBtn" class="btn btn-ghost" onclick="toggleTheme()">ğŸŒ™ æ·±è‰²æ¨¡å¼</button>
                </div>
            </div>
            <h1>ğŸ” æ–‡å­—åŠ å¯†è§£å¯†ç³»ç»Ÿ</h1>
            <p class="subtitle">Text Encryption & Decryption System</p>
            
            <div class="algorithm-info">
                <h3>ğŸ”’ åŠ å¯†ç®—æ³•è¯´æ˜</h3>
                <p>
                    <strong>åŠ å¯†ç®—æ³•ï¼š</strong>AES-GCM (Advanced Encryption Standard - Galois/Counter Mode) |
                    <strong>å¯†é’¥æ´¾ç”Ÿï¼š</strong>SHA-256 (è¾“å…¥æ•°å­— â†’ 256ä½å“ˆå¸Œ â†’ 32å­—èŠ‚å¯†é’¥) |
                    <strong>å¯†é’¥é•¿åº¦ï¼š</strong>256ä½ |
                    <strong>å®‰å…¨çº§åˆ«ï¼š</strong>å†›äº‹çº§åŠ å¯†
                </p>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Encryption Section -->
            <div class="section encrypt-section">
                <div class="section-title">
                    <span class="icon">ğŸ”’</span>
                    <span>åŠ å¯†åŒºåŸŸ Encryption</span>
                </div>

                <div id="encryptAlert" class="alert"></div>

                <div class="form-group">
                    <label class="form-label">
                        æ˜æ–‡å†…å®¹ <span class="required">*</span>
                    </label>
                    <textarea 
                        id="plainText" 
                        class="form-textarea" 
                        placeholder="è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡å­—ï¼ˆæ”¯æŒä¸­è‹±æ–‡ï¼‰&#10;Enter text to encrypt (supports Chinese and English)"
                    ></textarea>
                    <div class="char-counter">
                        <span id="plainTextCount">0</span> å­—ç¬¦
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        æ•°å­—å¯†é’¥ <span class="required">*</span>
                    </label>
                    <div class="password-input-wrapper">
                        <input 
                            type="password" 
                            id="encryptKey" 
                            class="form-input" 
                            placeholder="è¯·è¾“å…¥çº¯æ•°å­—å¯†é’¥ï¼ˆå»ºè®®8ä½ä»¥ä¸Šï¼‰"
                        >
                        <button class="password-toggle" onclick="togglePassword('encryptKey')">
                            ğŸ‘ï¸
                        </button>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="encryptText()">
                        <span>ğŸ”’</span> åŠ å¯†
                    </button>
                    <button class="btn btn-outline" onclick="clearEncrypt()">
                        <span>ğŸ—‘ï¸</span> æ¸…ç©º
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">åŠ å¯†ç»“æœ</label>
                    <textarea 
                        id="encryptedText" 
                        class="form-textarea" 
                        placeholder="åŠ å¯†åçš„å¯†æ–‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"
                        readonly
                    ></textarea>
                    <div class="char-counter">
                        <span id="encryptedTextCount">0</span> å­—ç¬¦
                    </div>
                </div>

                <button class="btn btn-success" onclick="copyEncrypted()">
                    <span>ğŸ“‹</span> å¤åˆ¶å¯†æ–‡
                </button>
            </div>

            <!-- Decryption Section -->
            <div class="section decrypt-section">
                <div class="section-title">
                    <span class="icon">ğŸ”“</span>
                    <span>è§£å¯†åŒºåŸŸ Decryption</span>
                </div>

                <div id="decryptAlert" class="alert"></div>

                <div class="form-group">
                    <label class="form-label">
                        å¯†æ–‡å†…å®¹ <span class="required">*</span>
                    </label>
                    <textarea 
                        id="cipherText" 
                        class="form-textarea" 
                        placeholder="è¯·ç²˜è´´è¦è§£å¯†çš„å¯†æ–‡&#10;Paste encrypted text here"
                    ></textarea>
                    <div class="char-counter">
                        <span id="cipherTextCount">0</span> å­—ç¬¦
                    </div>
                </div>

                <div class="form-group">
                    <label class="form-label">
                        æ•°å­—å¯†é’¥ <span class="required">*</span>
                    </label>
                    <div class="password-input-wrapper">
                        <input 
                            type="password" 
                            id="decryptKey" 
                            class="form-input" 
                            placeholder="è¯·è¾“å…¥è§£å¯†å¯†é’¥ï¼ˆå¿…é¡»ä¸åŠ å¯†æ—¶ç›¸åŒï¼‰"
                        >
                        <button class="password-toggle" onclick="togglePassword('decryptKey')">
                            ğŸ‘ï¸
                        </button>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn btn-secondary" onclick="decryptText()">
                        <span>ğŸ”“</span> è§£å¯†
                    </button>
                    <button class="btn btn-outline" onclick="clearDecrypt()">
                        <span>ğŸ—‘ï¸</span> æ¸…ç©º
                    </button>
                </div>

                <div class="form-group">
                    <label class="form-label">è§£å¯†ç»“æœ</label>
                    <textarea 
                        id="decryptedText" 
                        class="form-textarea" 
                        placeholder="è§£å¯†åçš„æ˜æ–‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ"
                        readonly
                    ></textarea>
                    <div class="char-counter">
                        <span id="decryptedTextCount">0</span> å­—ç¬¦
                    </div>
                </div>

                <button class="btn btn-success" onclick="copyDecrypted()">
                    <span>ğŸ“‹</span> å¤åˆ¶æ˜æ–‡
                </button>
            </div>
        </div>

        <!-- Operation Area -->
        <div class="operation-area">
            <div class="operation-title">âš¡ å¿«æ·æ“ä½œ Quick Actions</div>
            <div class="quick-actions">
                <button class="btn btn-outline" onclick="clearAll()">
                    <span>ğŸ—‘ï¸</span> å…¨éƒ¨æ¸…ç©º
                </button>
                <button class="btn btn-outline" onclick="swapText()">
                    <span>ğŸ”„</span> äº¤æ¢å†…å®¹
                </button>
                <button class="btn btn-outline" onclick="generateRandomKey()">
                    <span>ğŸ²</span> ç”Ÿæˆéšæœºå¯†é’¥
                </button>
                <button class="btn btn-outline" onclick="downloadResult()">
                    <span>ğŸ’¾</span> ä¸‹è½½ç»“æœ
                </button>
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="usage-tips">
                <h3>ğŸ“– ä½¿ç”¨æç¤º Usage Tips</h3>
                <div class="tips-grid">
                    <div class="tip-item">
                        <div class="tip-icon">ğŸ”‘</div>
                        <div class="tip-content">
                            <h4>å¯†é’¥è¦æ±‚</h4>
                            <p>è¯·ä½¿ç”¨çº¯æ•°å­—å¯†é’¥ï¼Œå»ºè®®8ä½ä»¥ä¸Šï¼Œå¯†é’¥è¶Šé•¿è¶Šå®‰å…¨ã€‚åŠ å¯†å’Œè§£å¯†å¿…é¡»ä½¿ç”¨ç›¸åŒå¯†é’¥ã€‚</p>
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">ğŸ”’</div>
                        <div class="tip-content">
                            <h4>åŠ å¯†æµç¨‹</h4>
                            <p>è¾“å…¥å¯†é’¥ â†’ SHA-256å“ˆå¸Œ â†’ ç”ŸæˆAESå¯†é’¥ â†’ AES-GCMåŠ å¯† â†’ Base64ç¼–ç è¾“å‡º</p>
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">ğŸŒ</div>
                        <div class="tip-content">
                            <h4>å®‰å…¨è¯´æ˜</h4>
                            <p>æ‰€æœ‰åŠ å¯†è§£å¯†æ“ä½œå‡åœ¨æœ¬åœ°æµè§ˆå™¨å®Œæˆï¼Œä¸ä¼šä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œæ‚¨çš„æ•°æ®å®Œå…¨å®‰å…¨ã€‚</p>
                        </div>
                    </div>
                    <div class="tip-item">
                        <div class="tip-icon">ğŸ’¾</div>
                        <div class="tip-content">
                            <h4>ä¿å­˜å¯†é’¥</h4>
                            <p>è¯·åŠ¡å¿…å¦¥å–„ä¿ç®¡æ‚¨çš„å¯†é’¥ï¼Œä¸¢å¤±å¯†é’¥å°†æ— æ³•è§£å¯†ã€‚å»ºè®®ä½¿ç”¨å¯†ç ç®¡ç†å™¨ä¿å­˜ã€‚</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="copyright">
                <p>Â© 2026 Text Encryption & Decryption System | åŸºäº Web Crypto API å®ç°</p>
                <p style="margin-top: 0.5rem;">
                    <small>ç®—æ³•ï¼šAES-256-GCM | å¯†é’¥æ´¾ç”Ÿï¼šSHA-256 | å®‰å…¨çº§åˆ«ï¼šå†›äº‹çº§</small>
                </p>
            </div>
        </div>
    </div>

    <script>
        // ==========================================
        // å…¨å±€å˜é‡å’Œå·¥å…·å‡½æ•°
        // ==========================================

        // å­—ç¬¦è®¡æ•°å™¨æ›´æ–°
        document.addEventListener('DOMContentLoaded', () => {
            setupCharCounters();
            initTheme();
        });

        function initTheme() {
            const savedTheme = localStorage.getItem('encryptTheme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.body.classList.add('dark-mode');
            }
            updateThemeButton();
        }

        function toggleTheme() {
            document.body.classList.toggle('dark-mode');
            localStorage.setItem('encryptTheme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
            updateThemeButton();
        }

        function updateThemeButton() {
            const button = document.getElementById('themeToggleBtn');
            if (!button) return;
            const isDark = document.body.classList.contains('dark-mode');
            button.innerHTML = isDark ? 'â˜€ï¸ æµ…è‰²æ¨¡å¼' : 'ğŸŒ™ æ·±è‰²æ¨¡å¼';
        }

        function goHome() {
            window.location.href = 'index.html';
        }

        function setupCharCounters() {
            const counters = [
                { textarea: 'plainText', counter: 'plainTextCount' },
                { textarea: 'cipherText', counter: 'cipherTextCount' },
                { textarea: 'encryptedText', counter: 'encryptedTextCount' },
                { textarea: 'decryptedText', counter: 'decryptedTextCount' }
            ];

            counters.forEach(({ textarea, counter }) => {
                const element = document.getElementById(textarea);
                element?.addEventListener('input', () => {
                    document.getElementById(counter).textContent = element.value.length;
                });
            });
        }

        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showAlert(elementId, message, type) {
            const alert = document.getElementById(elementId);
            alert.className = `alert alert-${type} show`;
            alert.textContent = message;
            setTimeout(() => {
                alert.classList.remove('show');
            }, 5000);
        }

        // åˆ‡æ¢å¯†ç å¯è§æ€§
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            input.type = input.type === 'password' ? 'text' : 'password';
        }

        // éªŒè¯æ•°å­—å¯†é’¥
        function validateKey(key) {
            if (!key) {
                return { valid: false, message: 'âŒ å¯†é’¥ä¸èƒ½ä¸ºç©ºï¼' };
            }
            if (!/^\d+$/.test(key)) {
                return { valid: false, message: 'âŒ å¯†é’¥å¿…é¡»æ˜¯çº¯æ•°å­—ï¼' };
            }
            if (key.length < 6) {
                return { valid: false, message: 'âš ï¸ å¯†é’¥å¤ªçŸ­ï¼Œå»ºè®®è‡³å°‘6ä½ï¼' };
            }
            return { valid: true };
        }

        // ==========================================
        // åŠ å¯†æ ¸å¿ƒå‡½æ•°
        // ==========================================

        // å°†æ•°å­—å¯†é’¥æ´¾ç”Ÿä¸ºAESå¯†é’¥
        async function deriveKey(password) {
            // å°†å¯†ç è½¬æ¢ä¸ºUint8Array
            const encoder = new TextEncoder();
            const passwordBuffer = encoder.encode(password);
            
            // ä½¿ç”¨SHA-256ç”Ÿæˆå“ˆå¸Œ
            const hashBuffer = await crypto.subtle.digest('SHA-256', passwordBuffer);
            
            // å¯¼å…¥ä¸ºAESå¯†é’¥
            return await crypto.subtle.importKey(
                'raw',
                hashBuffer,
                { name: 'AES-GCM', length: 256 },
                false,
                ['encrypt', 'decrypt']
            );
        }

        // åŠ å¯†æ–‡æœ¬
        async function encryptText() {
            const plainText = document.getElementById('plainText').value;
            const key = document.getElementById('encryptKey').value;
            const btn = event.target;

            // éªŒè¯è¾“å…¥
            if (!plainText) {
                showAlert('encryptAlert', 'âŒ è¯·è¾“å…¥è¦åŠ å¯†çš„æ–‡å­—ï¼', 'error');
                return;
            }

            const keyValidation = validateKey(key);
            if (!keyValidation.valid) {
                showAlert('encryptAlert', keyValidation.message, 'error');
                return;
            }

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                btn.classList.add('loading');
                btn.disabled = true;

                // æ´¾ç”Ÿå¯†é’¥
                const cryptoKey = await deriveKey(key);

                // ç”ŸæˆéšæœºIVï¼ˆåˆå§‹åŒ–å‘é‡ï¼‰
                const iv = crypto.getRandomValues(new Uint8Array(12));

                // ç¼–ç æ˜æ–‡
                const encoder = new TextEncoder();
                const data = encoder.encode(plainText);

                // åŠ å¯†
                const encryptedBuffer = await crypto.subtle.encrypt(
                    { name: 'AES-GCM', iv: iv },
                    cryptoKey,
                    data
                );

                // åˆå¹¶IVå’Œå¯†æ–‡
                const combined = new Uint8Array(iv.length + encryptedBuffer.byteLength);
                combined.set(iv);
                combined.set(new Uint8Array(encryptedBuffer), iv.length);

                // è½¬æ¢ä¸ºBase64
                const base64 = btoa(String.fromCharCode.apply(null, combined));
                
                document.getElementById('encryptedText').value = base64;
                document.getElementById('encryptedTextCount').textContent = base64.length;
                
                showAlert('encryptAlert', 'âœ… åŠ å¯†æˆåŠŸï¼è¯·å¦¥å–„ä¿ç®¡å¯†æ–‡å’Œå¯†é’¥ã€‚', 'success');

            } catch (error) {
                console.error('åŠ å¯†é”™è¯¯:', error);
                showAlert('encryptAlert', 'âŒ åŠ å¯†å¤±è´¥ï¼š' + error.message, 'error');
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        // ==========================================
        // è§£å¯†æ ¸å¿ƒå‡½æ•°
        // ==========================================

        // è§£å¯†æ–‡æœ¬
        async function decryptText() {
            const cipherText = document.getElementById('cipherText').value;
            const key = document.getElementById('decryptKey').value;
            const btn = event.target;

            // éªŒè¯è¾“å…¥
            if (!cipherText) {
                showAlert('decryptAlert', 'âŒ è¯·è¾“å…¥è¦è§£å¯†çš„å¯†æ–‡ï¼', 'error');
                return;
            }

            const keyValidation = validateKey(key);
            if (!keyValidation.valid) {
                showAlert('decryptAlert', keyValidation.message, 'error');
                return;
            }

            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                btn.classList.add('loading');
                btn.disabled = true;

                // æ´¾ç”Ÿå¯†é’¥
                const cryptoKey = await deriveKey(key);

                // ä»Base64è§£ç 
                const combined = Uint8Array.from(atob(cipherText), c => c.charCodeAt(0));

                // åˆ†ç¦»IVå’Œå¯†æ–‡
                const iv = combined.slice(0, 12);
                const encryptedData = combined.slice(12);

                // è§£å¯†
                const decryptedBuffer = await crypto.subtle.decrypt(
                    { name: 'AES-GCM', iv: iv },
                    cryptoKey,
                    encryptedData
                );

                // è§£ç ä¸ºæ–‡æœ¬
                const decoder = new TextDecoder();
                const plainText = decoder.decode(decryptedBuffer);
                
                document.getElementById('decryptedText').value = plainText;
                document.getElementById('decryptedTextCount').textContent = plainText.length;
                
                showAlert('decryptAlert', 'âœ… è§£å¯†æˆåŠŸï¼', 'success');

            } catch (error) {
                console.error('è§£å¯†é”™è¯¯:', error);
                showAlert('decryptAlert', 'âŒ è§£å¯†å¤±è´¥ï¼šå¯†é’¥é”™è¯¯æˆ–å¯†æ–‡æŸåï¼', 'error');
            } finally {
                btn.classList.remove('loading');
                btn.disabled = false;
            }
        }

        // ==========================================
        // è¾…åŠ©åŠŸèƒ½å‡½æ•°
        // ==========================================

        // æ¸…ç©ºåŠ å¯†åŒºåŸŸ
        function clearEncrypt() {
            document.getElementById('plainText').value = '';
            document.getElementById('encryptKey').value = '';
            document.getElementById('encryptedText').value = '';
            document.getElementById('plainTextCount').textContent = '0';
            document.getElementById('encryptedTextCount').textContent = '0';
            showAlert('encryptAlert', 'â„¹ï¸ åŠ å¯†åŒºåŸŸå·²æ¸…ç©º', 'info');
        }

        // æ¸…ç©ºè§£å¯†åŒºåŸŸ
        function clearDecrypt() {
            document.getElementById('cipherText').value = '';
            document.getElementById('decryptKey').value = '';
            document.getElementById('decryptedText').value = '';
            document.getElementById('cipherTextCount').textContent = '0';
            document.getElementById('decryptedTextCount').textContent = '0';
            showAlert('decryptAlert', 'â„¹ï¸ è§£å¯†åŒºåŸŸå·²æ¸…ç©º', 'info');
        }

        // æ¸…ç©ºæ‰€æœ‰
        function clearAll() {
            if (confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†…å®¹å—ï¼Ÿ')) {
                clearEncrypt();
                clearDecrypt();
            }
        }

        // å¤åˆ¶å¯†æ–‡
        function copyEncrypted() {
            const text = document.getElementById('encryptedText').value;
            if (!text) {
                showAlert('encryptAlert', 'âš ï¸ æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼', 'error');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showAlert('encryptAlert', 'âœ… å¯†æ–‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            });
        }

        // å¤åˆ¶æ˜æ–‡
        function copyDecrypted() {
            const text = document.getElementById('decryptedText').value;
            if (!text) {
                showAlert('decryptAlert', 'âš ï¸ æ²¡æœ‰å¯å¤åˆ¶çš„å†…å®¹ï¼', 'error');
                return;
            }
            navigator.clipboard.writeText(text).then(() => {
                showAlert('decryptAlert', 'âœ… æ˜æ–‡å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
            });
        }

        // äº¤æ¢å†…å®¹ï¼ˆå°†åŠ å¯†ç»“æœç§»åˆ°è§£å¯†åŒºï¼‰
        function swapText() {
            const encrypted = document.getElementById('encryptedText').value;
            if (!encrypted) {
                alert('âš ï¸ æ²¡æœ‰å¯äº¤æ¢çš„å†…å®¹ï¼è¯·å…ˆè¿›è¡ŒåŠ å¯†ã€‚');
                return;
            }
            document.getElementById('cipherText').value = encrypted;
            document.getElementById('cipherTextCount').textContent = encrypted.length;
            showAlert('decryptAlert', 'â„¹ï¸ å¯†æ–‡å·²ç§»è‡³è§£å¯†åŒºåŸŸ', 'info');
        }

        // ç”Ÿæˆéšæœºå¯†é’¥
        function generateRandomKey() {
            const length = 12; // 12ä½æ•°å­—
            let key = '';
            for (let i = 0; i < length; i++) {
                key += Math.floor(Math.random() * 10);
            }
            
            // åŒæ—¶è®¾ç½®åˆ°åŠ å¯†å’Œè§£å¯†åŒºåŸŸ
            document.getElementById('encryptKey').value = key;
            document.getElementById('decryptKey').value = key;
            
            // ä¸´æ—¶æ˜¾ç¤ºå¯†é’¥
            alert('ğŸ² å·²ç”Ÿæˆéšæœºå¯†é’¥ï¼š' + key + '\n\nè¯·åŠ¡å¿…è®°ä½æ­¤å¯†é’¥ï¼');
        }

        // ä¸‹è½½ç»“æœ
        function downloadResult() {
            const encrypted = document.getElementById('encryptedText').value;
            const decrypted = document.getElementById('decryptedText').value;
            
            if (!encrypted && !decrypted) {
                alert('âš ï¸ æ²¡æœ‰å¯ä¸‹è½½çš„å†…å®¹ï¼');
                return;
            }

            let content = '===== åŠ å¯†è§£å¯†ç»“æœ =====\n\n';
            
            if (encrypted) {
                content += 'ã€å¯†æ–‡ã€‘\n' + encrypted + '\n\n';
            }
            
            if (decrypted) {
                content += 'ã€æ˜æ–‡ã€‘\n' + decrypted + '\n\n';
            }
            
            content += 'ç”Ÿæˆæ—¶é—´ï¼š' + new Date().toLocaleString('zh-CN');
            
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'encryption_result_' + Date.now() + '.txt';
            a.click();
            URL.revokeObjectURL(url);
            
            alert('âœ… ç»“æœå·²ä¿å­˜ä¸ºæ–‡æœ¬æ–‡ä»¶ï¼');
        }

        // é”®ç›˜å¿«æ·é”®
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + Enter å¿«é€ŸåŠ å¯†
            if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                e.preventDefault();
                const activeElement = document.activeElement;
                if (activeElement.id === 'plainText' || activeElement.id === 'encryptKey') {
                    encryptText();
                } else if (activeElement.id === 'cipherText' || activeElement.id === 'decryptKey') {
                    decryptText();
                }
            }
        });

        // é¡µé¢åŠ è½½å®Œæˆæç¤º
        window.addEventListener('load', () => {
            console.log('ğŸ” åŠ å¯†ç³»ç»Ÿå·²å°±ç»ª');
            console.log('ç®—æ³•ï¼šAES-256-GCM | å¯†é’¥æ´¾ç”Ÿï¼šSHA-256');
        });
    </script>
</body>
</html>
